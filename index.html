<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rocko's Modern Gym App</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Your complete strength training companion - track workouts, calculate plates, and monitor progress">
    <meta name="theme-color" content="#0a0e27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rocko's Gym">
    <link rel="manifest" href="manifest.json">
    
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’ª</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’ª</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background: #0a0e27;
            overflow-x: hidden;
        }
        
        .bg-animated {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 25%, #0a0e27 50%, #2d1b4e 75%, #0a0e27 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        .glass-strong {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0 12px 48px 0 rgba(0, 0, 0, 0.5);
        }
        
        .glow-blue {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5), 0 0 60px rgba(59, 130, 246, 0.3);
        }
        
        .glow-purple {
            box-shadow: 0 0 30px rgba(168, 85, 247, 0.5), 0 0 60px rgba(168, 85, 247, 0.3);
        }
        
        .glow-green {
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.5), 0 0 60px rgba(34, 197, 94, 0.3);
        }
        
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .calendar-day::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(168, 85, 247, 0.2));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .calendar-day:hover::before {
            opacity: 1;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #a855f7, #ec4899);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
        }
        
        @keyframes progressSlide {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 0%; }
        }
        
        .progress-animated {
            background: linear-gradient(90deg, #3b82f6, #a855f7, #ec4899, #3b82f6);
            background-size: 200% 100%;
            animation: progressSlide 2s linear infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        .stagger-4 { animation-delay: 0.4s; }
        
        input:focus, select:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 0 20px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
        }
        
        .stat-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            animation: slideUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(100px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
        
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .ripple:active::after {
            width: 300px;
            height: 300px;
        }
    </style>
</head>
<body class="bg-animated text-white min-h-screen">
    <!-- Gradient overlay -->
    <div class="fixed inset-0 bg-gradient-to-br from-blue-500/5 via-purple-500/5 to-pink-500/5 pointer-events-none"></div>
    
    <div id="app" class="relative max-w-6xl mx-auto p-4 md:p-6"></div>

    <script>
        // State Management
        let state = {
            view: 'calc',
            weight: '',
            unit: 'lbs',
            bar: 'standard',
            exercise: 'squat',
            bodyweight: '',
            gender: 'male',
            category: 'natural',
            userName: localStorage.getItem('userName') || '',
            workouts: JSON.parse(localStorage.getItem('workouts') || '[]'),
            currentSets: [],
            prs: JSON.parse(localStorage.getItem('prs') || '[]'),
            workoutExercise: 'squat',
            workoutWeight: '',
            workoutReps: '',
            workoutSets: '1',
            showNameDialog: false,
            showPRDialog: false,
            prData: null,
            repWeight: '',
            reps: '',
            selectedDate: new Date(),
            calendarMonth: new Date().getMonth(),
            calendarYear: new Date().getFullYear()
        };

        // Exercise Data (Alphabetized by name)
        const exercises = {
            abWheel: 'Ab Wheel Rollout',
            arnoldPress: 'Arnold Press',
            stoneLoad: 'Atlas Stone Load',
            axlePress: 'Axle Press',
            backExtension: 'Back Extension',
            row: 'Barbell Row',
            bench: 'Bench Press',
            bicepcurl: 'Bicep Curl',
            boxSquat: 'Box Squat',
            bulgarianSplit: 'Bulgarian Split Squat',
            cableRow: 'Cable Row',
            cableWoodchop: 'Cable Woodchop',
            calfRaise: 'Calf Raise',
            chestRow: 'Chest Supported Row',
            chinups: 'Chin-ups',
            cleanJerk: 'Clean and Jerk',
            closeBench: 'Close Grip Bench',
            deadlift: 'Deadlift',
            declineBench: 'Decline Bench Press',
            deficitDL: 'Deficit Deadlift',
            dips: 'Dips',
            dbBench: 'Dumbbell Bench Press',
            dbOHP: 'Dumbbell Overhead Press',
            dbRow: 'Dumbbell Row',
            facePulls: 'Face Pulls',
            farmersWalk: "Farmer's Walk",
            floorPress: 'Floor Press',
            frontSquat: 'Front Squat',
            gluteBridge: 'Glute Bridge',
            gobletSquat: 'Goblet Squat',
            hackSquat: 'Hack Squat',
            hammerCurl: 'Hammer Curl',
            hangClean: 'Hang Clean',
            hangingLegRaise: 'Hanging Leg Raise',
            hipThrust: 'Hip Thrust',
            inclineBench: 'Incline Bench Press',
            latPulldown: 'Lat Pulldown',
            lateralRaise: 'Lateral Raise',
            legCurl: 'Leg Curl',
            legExtension: 'Leg Extension',
            legPress: 'Leg Press',
            logPress: 'Log Press',
            lunges: 'Lunges',
            ohp: 'Overhead Press',
            pauseBench: 'Pause Bench Press',
            pauseSquat: 'Pause Squat',
            pendlayRow: 'Pendlay Row',
            plank: 'Plank',
            plateHold: 'Plate Hold',
            powerClean: 'Power Clean',
            powerSnatch: 'Power Snatch',
            preacherCurl: 'Preacher Curl',
            pullups: 'Pull-ups',
            pushPress: 'Push Press',
            rackPull: 'Rack Pull',
            romanianDL: 'Romanian Deadlift',
            russianTwist: 'Russian Twist',
            seatedCalfRaise: 'Seated Calf Raise',
            seatedOHP: 'Seated Overhead Press',
            shrugs: 'Shrugs',
            skullcrushers: 'Skullcrushers',
            snatch: 'Snatch',
            squat: 'Squat',
            stiffLegDL: 'Stiff Leg Deadlift',
            sumoDeadlift: 'Sumo Deadlift',
            tbarRow: 'T-Bar Row',
            tireFlip: 'Tire Flip',
            trapBarDL: 'Trap Bar Deadlift',
            tricepExt: 'Tricep Extension',
            vikingPress: 'Viking Press',
            yokeWalk: 'Yoke Walk'
        };

        // Bar and Plate Data
        const bars = { 
            standard: { lbs: 45, kg: 20 }, 
            womens: { lbs: 35, kg: 15 }, 
            ezBar: { lbs: 25, kg: 11 }, 
            trap: { lbs: 60, kg: 27 } 
        };
        
        const barNames = { 
            standard: 'Standard Bar (45/20)', 
            womens: "Women's Bar (35/15)", 
            ezBar: 'EZ Curl Bar (25/11)', 
            trap: 'Trap Bar (60/27)' 
        };
        
        const plates = { 
            lbs: [45, 35, 25, 10, 5, 2.5], 
            kg: [25, 20, 15, 10, 5, 2.5, 1.25] 
        };

        // Strength Standards Data
        const strengthStandards = {
            natural: {
                male: {
                    squat: {untrained: 0.65, novice: 1.15, intermediate: 1.70, advanced: 2.20, elite: 2.75},
                    bench: {untrained: 0.50, novice: 0.75, intermediate: 1.25, advanced: 1.75, elite: 2.25},
                    deadlift: {untrained: 0.80, novice: 1.40, intermediate: 2.00, advanced: 2.60, elite: 3.25},
                    ohp: {untrained: 0.35, novice: 0.55, intermediate: 0.85, advanced: 1.15, elite: 1.50},
                    row: {untrained: 0.40, novice: 0.70, intermediate: 1.10, advanced: 1.50, elite: 1.90}
                },
                female: {
                    squat: {untrained: 0.45, novice: 0.75, intermediate: 1.20, advanced: 1.60, elite: 2.05},
                    bench: {untrained: 0.30, novice: 0.50, intermediate: 0.80, advanced: 1.10, elite: 1.45},
                    deadlift: {untrained: 0.55, novice: 0.95, intermediate: 1.45, advanced: 1.90, elite: 2.45},
                    ohp: {untrained: 0.20, novice: 0.35, intermediate: 0.55, advanced: 0.75, elite: 1.00},
                    row: {untrained: 0.25, novice: 0.45, intermediate: 0.75, advanced: 1.00, elite: 1.30}
                }
            },
            enhanced: {
                male: {
                    squat: {untrained: 0.65, novice: 1.15, intermediate: 1.90, advanced: 2.60, elite: 3.50},
                    bench: {untrained: 0.50, novice: 0.75, intermediate: 1.40, advanced: 2.10, elite: 2.90},
                    deadlift: {untrained: 0.80, novice: 1.40, intermediate: 2.20, advanced: 3.00, elite: 4.20},
                    ohp: {untrained: 0.35, novice: 0.55, intermediate: 0.95, advanced: 1.40, elite: 1.95},
                    row: {untrained: 0.40, novice: 0.70, intermediate: 1.25, advanced: 1.80, elite: 2.45}
                },
                female: {
                    squat: {untrained: 0.45, novice: 0.75, intermediate: 1.35, advanced: 1.95, elite: 2.70},
                    bench: {untrained: 0.30, novice: 0.50, intermediate: 0.95, advanced: 1.40, elite: 1.95},
                    deadlift: {untrained: 0.55, novice: 0.95, intermediate: 1.65, advanced: 2.35, elite: 3.25},
                    ohp: {untrained: 0.20, novice: 0.35, intermediate: 0.65, advanced: 0.95, elite: 1.35},
                    row: {untrained: 0.25, novice: 0.45, intermediate: 0.90, advanced: 1.30, elite: 1.75}
                }
            }
        };

        // Level Colors
        const levelColors = {
            beginner: 'text-gray-400',
            untrained: 'text-blue-400',
            novice: 'text-green-400',
            intermediate: 'text-yellow-400',
            advanced: 'text-orange-400',
            elite: 'text-red-400'
        };

        const levelBgColors = {
            beginner: 'bg-gray-600',
            untrained: 'bg-blue-600',
            novice: 'bg-green-600',
            intermediate: 'bg-yellow-600',
            advanced: 'bg-orange-600',
            elite: 'bg-red-600'
        };

        // Calculate Plates
        function calculatePlates() {
            const target = parseFloat(state.weight);
            if (!target || target <= 0) return null;
            
            const barWeight = bars[state.bar][state.unit];
            if (target <= barWeight) return { error: 'Weight is less than or equal to bar weight' };
            
            const weightToLoad = target - barWeight;
            const perSide = weightToLoad / 2;
            const result = [];
            let remaining = perSide;
            
            for (const plate of plates[state.unit]) {
                const count = Math.floor(remaining / plate);
                if (count > 0) {
                    result.push({ weight: plate, count });
                    remaining -= plate * count;
                }
            }
            
            if (remaining > 0.1) {
                return { 
                    error: `Closest weight: ${(target - remaining * 2).toFixed(1)} ${state.unit}`, 
                    plates: result 
                };
            }
            
            return { plates: result };
        }

        // Calculate 1RM
        function calculate1RM() {
            const weight = parseFloat(state.repWeight);
            const reps = parseInt(state.reps);
            
            if (!weight || !reps || weight <= 0 || reps <= 0 || reps > 12) return null;
            
            if (reps === 1) {
                const percentages = {};
                [95, 90, 85, 80, 75, 70, 65, 60].forEach(pct => {
                    percentages[pct] = (weight * pct / 100).toFixed(1);
                });
                return { avg: weight.toFixed(1), percentages };
            }
            
            // Epley formula: 1RM = weight Ã— (1 + reps/30)
            const epley = weight * (1 + reps / 30);
            // Brzycki formula: 1RM = weight Ã— (36/(37-reps))
            const brzycki = weight * (36 / (37 - reps));
            // Average of both formulas
            const avg = (epley + brzycki) / 2;
            
            const percentages = {};
            [95, 90, 85, 80, 75, 70, 65, 60].forEach(pct => {
                percentages[pct] = (avg * pct / 100).toFixed(1);
            });
            
            return { avg: avg.toFixed(1), percentages };
        }

        // Calculate Strength Level
        function calculateStrength() {
            const bodyweight = parseFloat(state.bodyweight);
            const weight = parseFloat(state.weight);
            
            if (!bodyweight || !weight || bodyweight <= 0 || weight <= 0) return null;
            
            // Convert to lbs for calculation
            const weightLbs = state.unit === 'kg' ? weight * 2.20462 : weight;
            const bodyweightLbs = state.unit === 'kg' ? bodyweight * 2.20462 : bodyweight;
            const ratio = weightLbs / bodyweightLbs;
            
            const standards = strengthStandards[state.category][state.gender][state.exercise];
            
            let level = 'beginner';
            let progress = 0;
            let nextLevel = 'untrained';
            
            if (ratio >= standards.elite) {
                level = 'elite';
                progress = 100;
                nextLevel = 'elite';
            } else if (ratio >= standards.advanced) {
                level = 'advanced';
                nextLevel = 'elite';
                progress = ((ratio - standards.advanced) / (standards.elite - standards.advanced)) * 100;
            } else if (ratio >= standards.intermediate) {
                level = 'intermediate';
                nextLevel = 'advanced';
                progress = ((ratio - standards.intermediate) / (standards.advanced - standards.intermediate)) * 100;
            } else if (ratio >= standards.novice) {
                level = 'novice';
                nextLevel = 'intermediate';
                progress = ((ratio - standards.novice) / (standards.intermediate - standards.novice)) * 100;
            } else if (ratio >= standards.untrained) {
                level = 'untrained';
                nextLevel = 'novice';
                progress = ((ratio - standards.untrained) / (standards.novice - standards.untrained)) * 100;
            } else {
                level = 'beginner';
                nextLevel = 'untrained';
                progress = (ratio / standards.untrained) * 100;
            }
            
            const nextWeight = standards[nextLevel] ? (standards[nextLevel] * bodyweightLbs) : null;
            const nextWeightConverted = nextWeight ? 
                (state.unit === 'kg' ? (nextWeight / 2.20462).toFixed(1) : nextWeight.toFixed(0)) : null;
            
            return {
                level,
                ratio: ratio.toFixed(2),
                progress: Math.min(progress, 100).toFixed(0),
                nextLevel,
                nextWeight: nextWeightConverted
            };
        }

        // Add Set
        function addSet() {
            if (!state.workoutWeight || !state.workoutReps) return;
            
            const numSets = parseInt(state.workoutSets) || 1;
            const sets = [];
            
            for (let i = 0; i < numSets; i++) {
                sets.push({
                    id: Date.now() + i,
                    exercise: exercises[state.workoutExercise],
                    weight: parseFloat(state.workoutWeight),
                    reps: parseInt(state.workoutReps),
                    unit: state.unit
                });
            }
            
            state.currentSets = [...state.currentSets, ...sets];
            state.workoutWeight = '';
            state.workoutReps = '';
            state.workoutSets = '1';
            render();
        }

        // Finish Workout
        function finishWorkout() {
            if (state.currentSets.length === 0) return;
            
            const workout = {
                id: Date.now(),
                date: new Date().toISOString(),
                sets: state.currentSets,
                volume: state.currentSets.reduce((sum, set) => sum + (set.weight * set.reps), 0)
            };
            
            state.workouts = [...state.workouts, workout];
            localStorage.setItem('workouts', JSON.stringify(state.workouts));
            state.currentSets = [];
            alert('ðŸŽ‰ Workout saved!');
            render();
        }

        // Check PR
        function checkPR(exerciseName, weight, reps) {
            const existingPRs = state.prs.filter(pr => pr.exercise === exerciseName && pr.unit === state.unit);
            const isNewPR = existingPRs.length === 0 || existingPRs.every(pr => pr.weight < weight);
            
            if (isNewPR) {
                state.prData = { exercise: exerciseName, weight, reps };
                state.showPRDialog = true;
                render();
            } else {
                alert('Not a new PR');
            }
        }

        // Save PR
        function savePR(share) {
            if (!state.prData) return;
            
            const newPR = {
                id: Date.now(),
                userName: state.userName || 'Anonymous',
                exercise: state.prData.exercise,
                weight: state.prData.weight,
                unit: state.unit,
                date: new Date().toISOString()
            };
            
            state.prs = [...state.prs, newPR];
            localStorage.setItem('prs', JSON.stringify(state.prs));
            
            if (share) {
                const msg = `ðŸŽ‰ New PR! ${state.userName || 'I'} just hit ${state.prData.weight} ${state.unit} Ã— ${state.prData.reps} on ${state.prData.exercise}! ðŸ’ª`;
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(msg)}`, '_blank');
            }
            
            state.showPRDialog = false;
            state.prData = null;
            render();
        }

        // Share Workout
        function shareWorkout(workout) {
            const setsList = workout.sets.map(s => `${s.exercise}: ${s.weight} ${s.unit} Ã— ${s.reps}`).join('\\n');
            const msg = `ðŸ’ª ${state.userName || 'I'} crushed a workout!\\n\\n${setsList}\\n\\nTotal Volume: ${workout.volume.toLocaleString()} ${state.unit}`;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(msg)}`, '_blank');
        }

        // Get Streak
        function getStreak() {
            if (state.workouts.length === 0) return 0;
            
            const dates = [...new Set(state.workouts.map(w => new Date(w.date).toDateString()))].sort((a, b) => new Date(b) - new Date(a));
            let streak = 0;
            
            for (let i = 0; i < dates.length; i++) {
                const checkDate = new Date();
                checkDate.setDate(checkDate.getDate() - i);
                if (dates.includes(checkDate.toDateString())) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // Share Streak
        function shareStreak() {
            const streak = getStreak();
            const msg = `ðŸ”¥ ${state.userName || 'I'} have a ${streak} day workout streak! Keep grinding! ðŸ’ª`;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}&quote=${encodeURIComponent(msg)}`, '_blank');
        }

        // Save User Name
        function saveUserName() {
            localStorage.setItem('userName', state.userName);
            state.showNameDialog = false;
            render();
        }

        // Delete Workout
        function deleteWorkout(id) {
            if (confirm('Are you sure you want to delete this workout?')) {
                state.workouts = state.workouts.filter(w => w.id !== id);
                localStorage.setItem('workouts', JSON.stringify(state.workouts));
                render();
            }
        }

        // Get Progress Data
        function getProgressData(exerciseName) {
            const data = [];
            state.workouts.forEach(wo => {
                wo.sets.forEach(s => {
                    if (s.exercise === exerciseName) {
                        data.push({
                            date: new Date(wo.date),
                            weight: s.weight,
                            reps: s.reps
                        });
                    }
                });
            });
            return data.sort((a, b) => a.date - b.date);
        }

        // Calendar Functions
        function getDaysInMonth(month, year) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(month, year) {
            return new Date(year, month, 1).getDay();
        }

        function getWorkoutDates() {
            return new Set(state.workouts.map(w => new Date(w.date).toDateString()));
        }

        function changeMonth(delta) {
            state.calendarMonth += delta;
            if (state.calendarMonth > 11) {
                state.calendarMonth = 0;
                state.calendarYear++;
            } else if (state.calendarMonth < 0) {
                state.calendarMonth = 11;
                state.calendarYear--;
            }
            render();
        }

        // Render Calendar
        function renderCalendar() {
            const daysInMonth = getDaysInMonth(state.calendarMonth, state.calendarYear);
            const firstDay = getFirstDayOfMonth(state.calendarMonth, state.calendarYear);
            const workoutDates = getWorkoutDates();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            let calendarHTML = `
                <div class="glass-strong rounded-3xl p-6 hover-lift fade-in">
                    <div class="flex items-center justify-between mb-6">
                        <button onclick="changeMonth(-1)" class="glass hover:glass-strong px-4 py-2 rounded-lg">â†</button>
                        <h3 class="text-xl font-bold">${monthNames[state.calendarMonth]} ${state.calendarYear}</h3>
                        <button onclick="changeMonth(1)" class="glass hover:glass-strong px-4 py-2 rounded-lg">â†’</button>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2 mb-2">
                        ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => 
                            `<div class="text-center text-sm text-gray-400 font-semibold">${day}</div>`
                        ).join('')}
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2">
                        ${Array(firstDay).fill(null).map(() => 
                            `<div class="calendar-day"></div>`
                        ).join('')}
                        
                        ${Array(daysInMonth).fill(null).map((_, i) => {
                            const day = i + 1;
                            const date = new Date(state.calendarYear, state.calendarMonth, day);
                            const dateString = date.toDateString();
                            const hasWorkout = workoutDates.has(dateString);
                            const isToday = dateString === new Date().toDateString();
                            
                            return `
                                <div class="calendar-day rounded-lg ${hasWorkout ? 'bg-green-600' : 'glass'} ${isToday ? 'ring-2 ring-blue-400' : ''} hover:glass-strong transition">
                                    <span class="text-sm ${hasWorkout ? 'font-bold' : ''}">${day}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="mt-6 flex items-center justify-center gap-4 text-sm">
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded bg-green-600"></div>
                            <span class="text-gray-400">Workout Day</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-4 h-4 rounded glass"></div>
                            <span class="text-gray-400">Rest Day</span>
                        </div>
                    </div>
                </div>
            `;
            
            return calendarHTML;
        }

        // Main Render Function
        function render() {
            const app = document.getElementById('app');
            const plateResult = calculatePlates();
            const strengthResult = calculateStrength();
            const oneRMResult = calculate1RM();
            const streak = getStreak();

            app.innerHTML = `
                <div class="text-center mb-6 pt-6">
                    <div class="flex items-center justify-center gap-3 mb-2">
                        <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        <h1 class="text-4xl font-bold">Rocko's Modern Gym App</h1>
                    </div>
                    <p class="text-gray-400">Your complete strength training companion</p>
                    ${state.userName ? 
                        `<button onclick="state.showNameDialog = true; render();" class="text-gray-400 hover:text-white text-sm mt-2">ðŸ‘¤ ${state.userName}</button>` :
                        `<button onclick="state.showNameDialog = true; render();" class="glass hover:glass-strong px-4 py-2 rounded-lg text-sm mt-2">ðŸ‘¤ Set Your Name</button>`
                    }
                </div>

                <div class="grid grid-cols-4 gap-2 mb-6 glass-strong p-2 rounded-xl">
                    <button onclick="state.view = 'calc'; render();" class="py-3 rounded-lg font-semibold flex flex-col items-center gap-1 transition ${state.view === 'calc' ? 'bg-blue-600' : 'text-gray-400 hover:glass'}">
                        <span>ðŸ’ª</span>
                        <span class="text-xs">Calc</span>
                    </button>
                    <button onclick="state.view = 'log'; render();" class="py-3 rounded-lg font-semibold flex flex-col items-center gap-1 transition ${state.view === 'log' ? 'bg-blue-600' : 'text-gray-400 hover:glass'}">
                        <span>ðŸ“</span>
                        <span class="text-xs">Log</span>
                    </button>
                    <button onclick="state.view = 'cal'; render();" class="py-3 rounded-lg font-semibold flex flex-col items-center gap-1 transition ${state.view === 'cal' ? 'bg-blue-600' : 'text-gray-400 hover:glass'}">
                        <span>ðŸ“…</span>
                        <span class="text-xs">Calendar</span>
                    </button>
                    <button onclick="state.view = 'prog'; render();" class="py-3 rounded-lg font-semibold flex flex-col items-center gap-1 transition ${state.view === 'prog' ? 'bg-blue-600' : 'text-gray-400 hover:glass'}">
                        <span>ðŸ“Š</span>
                        <span class="text-xs">Progress</span>
                    </button>
                </div>

                ${streak > 0 ? `
                    <div class="bg-gradient-to-r from-orange-600 to-red-600 rounded-xl p-4 mb-6 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-2xl">ðŸ”¥</span>
                            <span class="text-2xl font-bold">${streak} Day Streak!</span>
                        </div>
                        <button onclick="shareStreak()" class="text-3xl hover:scale-110 transition">ðŸ“˜</button>
                    </div>
                ` : ''}

                ${state.view === 'calc' ? `
                    <!-- Strength Standards Section -->
                    <div class="glass-strong rounded-3xl p-6 hover-lift fade-in mb-6">
                        <h3 class="text-xl font-bold mb-4">Strength Standards</h3>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <select onchange="state.exercise = this.value; render();" class="glass text-white rounded-lg px-4 py-3">
                                ${['squat', 'bench', 'deadlift', 'ohp', 'row'].map(ex => 
                                    `<option value="${ex}" ${state.exercise === ex ? 'selected' : ''}>${exercises[ex]}</option>`
                                ).join('')}
                            </select>
                            <select onchange="state.gender = this.value; render();" class="glass text-white rounded-lg px-4 py-3">
                                <option value="male" ${state.gender === 'male' ? 'selected' : ''}>Male</option>
                                <option value="female" ${state.gender === 'female' ? 'selected' : ''}>Female</option>
                            </select>
                        </div>
                        
                        <select onchange="state.category = this.value; render();" class="w-full glass text-white rounded-lg px-4 py-3 mb-4">
                            <option value="natural" ${state.category === 'natural' ? 'selected' : ''}>Natural Lifter</option>
                            <option value="enhanced" ${state.category === 'enhanced' ? 'selected' : ''}>Enhanced Lifter</option>
                        </select>
                        
                        <input type="number" value="${state.bodyweight}" oninput="state.bodyweight = this.value;" onchange="render();" placeholder="Your bodyweight (${state.unit})" class="w-full glass text-white rounded-lg px-4 py-3 mb-4">
                        
                        ${strengthResult ? `
                            <div class="glass rounded-xl p-6">
                                <div class="text-center mb-4">
                                    <div class="text-3xl font-bold ${levelColors[strengthResult.level]} capitalize mb-2">${strengthResult.level}</div>
                                    <div class="text-gray-400 text-sm">${strengthResult.ratio}x Bodyweight</div>
                                </div>
                                
                                ${strengthResult.level !== 'elite' ? `
                                    <div class="mb-4">
                                        <div class="flex justify-between text-xs text-gray-400 mb-2">
                                            <span>Progress to ${strengthResult.nextLevel}</span>
                                            <span>${strengthResult.progress}%</span>
                                        </div>
                                        <div class="w-full glass rounded-full h-3">
                                            <div class="h-3 rounded-full ${levelBgColors[strengthResult.level]} transition-all duration-500" style="width: ${strengthResult.progress}%"></div>
                                        </div>
                                    </div>
                                    ${strengthResult.nextWeight ? `
                                        <div class="text-center text-sm">
                                            <span class="text-gray-400">Next milestone:</span>
                                            <span class="text-white font-bold text-lg ml-2">${strengthResult.nextWeight} ${state.unit}</span>
                                        </div>
                                    ` : ''}
                                ` : `
                                    <div class="text-center text-green-400 font-semibold">ðŸ† Maximum Level Achieved!</div>
                                `}
                            </div>
                        ` : ''}
                    </div>

                    <!-- 1RM Calculator Section -->
                    <div class="glass-strong rounded-3xl p-6 hover-lift fade-in mb-6">
                        <h3 class="text-xl font-bold mb-4">1RM Calculator</h3>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value="${state.repWeight}" oninput="state.repWeight = this.value;" onchange="render();" placeholder="Weight" class="glass text-white rounded-lg px-4 py-3">
                            <input type="number" value="${state.reps}" oninput="state.reps = this.value;" onchange="render();" placeholder="Reps (1-12)" class="glass text-white rounded-lg px-4 py-3">
                        </div>
                        
                        ${oneRMResult ? `
                            <div class="glass rounded-xl p-6">
                                <div class="text-center mb-6">
                                    <div class="text-sm text-gray-400 mb-2">Estimated 1 Rep Max</div>
                                    <div class="text-5xl font-bold text-green-400">${oneRMResult.avg}</div>
                                    <div class="text-sm text-gray-400 mt-1">${state.unit}</div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    ${[95, 90, 85, 80, 75, 70, 65, 60].map(pct => `
                                        <div class="glass-strong rounded-lg px-4 py-3 flex justify-between items-center">
                                            <span class="text-gray-400 font-semibold">${pct}%</span>
                                            <span class="text-white font-bold">${oneRMResult.percentages[pct]}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <button onclick="state.weight = '${oneRMResult.avg}'; render();" class="w-full mt-4 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 hover-scale transition-all ripple glow-green py-3 rounded-lg font-semibold transition">
                                    Use ${oneRMResult.avg} ${state.unit} as Target Weight
                                </button>
                            </div>
                        ` : `
                            <div class="text-center text-gray-400 py-6">
                                Enter weight and reps (1-12) to calculate your 1RM
                            </div>
                        `}
                    </div>

                    <!-- Plate Calculator Section -->
                    <div class="glass-strong rounded-2xl shadow-2xl p-6">
                        <h3 class="text-xl font-bold mb-4">Plate Calculator</h3>
                        
                        <div class="flex gap-2 mb-6">
                            <button onclick="state.unit = 'lbs'; render();" class="flex-1 py-3 rounded-lg font-semibold transition ${state.unit === 'lbs' ? 'bg-blue-600' : 'glass hover:glass-strong'}">LBS</button>
                            <button onclick="state.unit = 'kg'; render();" class="flex-1 py-3 rounded-lg font-semibold transition ${state.unit === 'kg' ? 'bg-blue-600' : 'glass hover:glass-strong'}">KG</button>
                        </div>
                        
                        <select onchange="state.bar = this.value; render();" class="w-full glass text-white rounded-lg px-4 py-3 mb-6">
                            ${Object.entries(barNames).map(([key, name]) => 
                                `<option value="${key}" ${state.bar === key ? 'selected' : ''}>${name}</option>`
                            ).join('')}
                        </select>
                        
                        <input type="number" value="${state.weight}" oninput="state.weight = this.value;" onchange="render();" placeholder="Enter target weight (${state.unit})" class="w-full glass text-white text-2xl rounded-lg px-4 py-3 mb-6">
                        
                        ${plateResult && plateResult.plates ? `
                            <div class="glass rounded-xl p-6">
                                ${plateResult.error ? `
                                    <p class="text-yellow-400 text-sm mb-4 text-center font-semibold">${plateResult.error}</p>
                                ` : ''}
                                <h4 class="text-xl font-bold mb-4 text-center">Load per side:</h4>
                                <div class="space-y-3">
                                    ${plateResult.plates.map(p => `
                                        <div class="flex items-center justify-between glass-strong rounded-xl p-4 hover-scale transition-all">
                                            <span class="text-2xl font-bold text-blue-400">${p.weight} ${state.unit}</span>
                                            <span class="text-xl text-gray-300">Ã— ${p.count}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : plateResult && plateResult.error ? `
                            <div class="glass rounded-xl p-6 text-center">
                                <p class="text-yellow-400">${plateResult.error}</p>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}

                ${state.view === 'log' ? `
                    <div class="glass-strong rounded-3xl p-6 hover-lift fade-in mb-6">
                        <h3 class="text-xl font-bold mb-4">Log Workout</h3>
                        
                        ${state.currentSets.length > 0 ? `
                            <div class="mb-6 glass rounded-xl p-4">
                                <h4 class="font-semibold mb-3 text-green-400">Current Workout</h4>
                                ${state.currentSets.map((set, idx) => `
                                    <div class="flex items-center justify-between glass-strong rounded-lg p-3 mb-2">
                                        <div>
                                            <span class="font-semibold">${set.exercise}</span>
                                            <span class="text-gray-400 ml-2">${set.weight} ${set.unit} Ã— ${set.reps}</span>
                                        </div>
                                        <button onclick="state.currentSets.splice(${idx}, 1); render();" class="text-red-400 hover:text-red-300 text-xl">Ã—</button>
                                    </div>
                                `).join('')}
                                <button onclick="finishWorkout()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 hover-scale transition-all ripple glow-green py-3 rounded-lg font-semibold mt-3 transition">
                                    âœ… Finish Workout
                                </button>
                            </div>
                        ` : ''}
                        
                        <select onchange="state.workoutExercise = this.value; render();" class="w-full glass text-white rounded-lg px-4 py-3 mb-4">
                            ${Object.entries(exercises).map(([key, name]) => 
                                `<option value="${key}" ${state.workoutExercise === key ? 'selected' : ''}>${name}</option>`
                            ).join('')}
                        </select>
                        
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <input type="number" value="${state.workoutWeight}" oninput="state.workoutWeight = this.value" placeholder="Weight" class="glass text-white rounded-lg px-4 py-3">
                            <input type="number" value="${state.workoutReps}" oninput="state.workoutReps = this.value" placeholder="Reps" class="glass text-white rounded-lg px-4 py-3">
                            <input type="number" value="${state.workoutSets}" oninput="state.workoutSets = this.value" placeholder="Sets" class="glass text-white rounded-lg px-4 py-3">
                        </div>
                        
                        <button onclick="addSet()" class="w-full btn-primary hover-scale transition-all ripple py-3 rounded-lg font-semibold transition">
                            âž• Add Set(s)
                        </button>
                    </div>

                    <div class="glass-strong rounded-3xl p-6 hover-lift fade-in">
                        <h3 class="text-xl font-bold mb-4">Recent Workouts</h3>
                        ${state.workouts.length === 0 ? `
                            <div class="text-center py-12">
                                <p class="text-gray-400 text-lg mb-2">No workouts logged yet!</p>
                                <p class="text-gray-500 text-sm">Start tracking your progress above</p>
                            </div>
                        ` : state.workouts.slice().reverse().slice(0, 10).map(w => `
                            <div class="glass rounded-xl p-4 hover-scale transition-all mb-4">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <div class="font-semibold text-lg">${new Date(w.date).toLocaleDateString()}</div>
                                        <div class="text-sm text-gray-400">${w.sets.length} sets â€¢ ${w.volume.toLocaleString()} ${state.unit} total volume</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick='shareWorkout(${JSON.stringify(w).replace(/'/g, "\\'")}); event.stopPropagation();' class="text-blue-400 text-2xl hover:scale-110 transition">ðŸ“˜</button>
                                        <button onclick="deleteWorkout(${w.id})" class="text-red-400 text-xl hover:scale-110 transition">ðŸ—‘ï¸</button>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    ${w.sets.map(s => `
                                        <div class="flex justify-between items-center glass-strong rounded px-3 py-2">
                                            <span class="text-sm text-gray-300">${s.exercise}: ${s.weight} ${s.unit} Ã— ${s.reps}</span>
                                            <button onclick='checkPR("${s.exercise}", ${s.weight}, ${s.reps}); event.stopPropagation();' class="text-xs bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 hover-scale transition-all ripple glow-green px-3 py-1 rounded font-semibold transition">
                                                PR?
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                ${state.view === 'cal' ? renderCalendar() : ''}

                ${state.view === 'prog' ? `
                    <div class="space-y-6">
                        ${Object.entries(exercises).map(([key, name]) => {
                            const data = getProgressData(name);
                            if (data.length === 0) return '';
                            
                            const maxWeight = Math.max(...data.map(d => d.weight));
                            const latestWeight = data[data.length - 1].weight;
                            const cumulativeWeight = data.reduce((sum, d) => sum + (d.weight * d.reps), 0);
                            
                            return `
                                <div class="glass-strong rounded-3xl p-6 hover-lift fade-in">
                                    <h3 class="text-xl font-bold mb-4">${name}</h3>
                                    
                                    <div class="grid grid-cols-3 gap-4 mb-4">
                                        <div class="glass rounded-xl p-4 hover-scale transition-all text-center">
                                            <div class="text-xs text-gray-400 mb-1">Current</div>
                                            <div class="text-2xl font-bold text-blue-400">${latestWeight}</div>
                                            <div class="text-xs text-gray-500">${state.unit}</div>
                                        </div>
                                        <div class="glass rounded-xl p-4 hover-scale transition-all text-center">
                                            <div class="text-xs text-gray-400 mb-1">Max</div>
                                            <div class="text-2xl font-bold text-green-400">${maxWeight}</div>
                                            <div class="text-xs text-gray-500">${state.unit}</div>
                                        </div>
                                        <div class="glass rounded-xl p-4 hover-scale transition-all text-center">
                                            <div class="text-xs text-gray-400 mb-1">Cumulative</div>
                                            <div class="text-2xl font-bold text-purple-400">
                                                ${cumulativeWeight.toLocaleString()}
                                            </div>
                                            <div class="text-xs text-gray-500">${state.unit}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="glass rounded-xl p-4 hover-scale transition-all">
                                        <h4 class="text-sm font-semibold mb-3 text-gray-400">Recent Sessions</h4>
                                        <div class="space-y-3">
                                            ${data.slice(-6).map(entry => `
                                                <div>
                                                    <div class="flex justify-between text-xs text-gray-400 mb-1">
                                                        <span>${entry.date.toLocaleDateString()}</span>
                                                        <span class="font-semibold">${entry.weight} ${state.unit} Ã— ${entry.reps}</span>
                                                    </div>
                                                    <div class="w-full glass rounded-full h-2">
                                                        <div class="h-2 rounded-full bg-gradient-to-r from-blue-600 to-green-500 transition-all duration-500" 
                                                             style="width: ${(entry.weight / maxWeight) * 100}%"></div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                        
                        ${state.workouts.length === 0 ? `
                            <div class="glass-strong rounded-3xl p-6 hover-lift fade-in text-center">
                                <p class="text-gray-400 text-lg mb-2">No progress data yet!</p>
                                <p class="text-gray-500 text-sm">Start logging workouts to track your gains</p>
                            </div>
                        ` : ''}
                    </div>
                ` : ''}

                ${state.showNameDialog ? `
                    <div class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
                        <div class="glass-strong rounded-3xl p-6 hover-lift fade-in max-w-md w-full">
                            <h3 class="text-xl font-bold mb-4">Set Your Name</h3>
                            <input type="text" value="${state.userName}" oninput="state.userName = this.value" placeholder="Enter your name" class="w-full glass text-white rounded-lg px-4 py-3 mb-4">
                            <div class="flex gap-3">
                                <button onclick="state.showNameDialog = false; render();" class="flex-1 glass hover:glass-strong py-3 rounded-lg transition">Cancel</button>
                                <button onclick="saveUserName()" class="flex-1 btn-primary hover-scale transition-all ripple py-3 rounded-lg font-semibold transition">Save</button>
                            </div>
                        </div>
                    </div>
                ` : ''}

                ${state.showPRDialog && state.prData ? `
                    <div class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
                        <div class="glass-strong rounded-3xl p-6 hover-lift fade-in max-w-md w-full">
                            <h3 class="text-2xl font-bold mb-4 text-center">ðŸŽ‰ New PR!</h3>
                            <div class="text-center mb-4">
                                <div class="text-lg font-bold text-green-400 mb-2">${state.prData.exercise}</div>
                                <div class="text-4xl font-bold text-blue-400 mb-1">${state.prData.weight} ${state.unit}</div>
                                <div class="text-gray-400">Ã— ${state.prData.reps} reps</div>
                            </div>
                            <p class="text-gray-400 text-sm text-center mb-6">Would you like to share this PR?</p>
                            <div class="flex gap-3">
                                <button onclick="savePR(false)" class="flex-1 glass hover:glass-strong py-3 rounded-lg font-semibold transition">Just Save</button>
                                <button onclick="savePR(true)" class="flex-1 btn-primary hover-scale transition-all ripple py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition">
                                    ðŸ“˜ Share
                                </button>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Initial render
        render();

        // PWA Install Prompt
        let deferredPrompt;
        const installPromptShown = localStorage.getItem('installPromptShown');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Only show prompt if not shown before
            if (!installPromptShown) {
                showInstallPrompt();
            }
        });

        function showInstallPrompt() {
            const promptHTML = `
                <div class="install-prompt bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-4 rounded-2xl shadow-2xl max-w-md mx-4">
                    <div class="flex items-center justify-between gap-4">
                        <div class="flex items-center gap-3">
                            <span class="text-3xl">ðŸ’ª</span>
                            <div>
                                <div class="font-bold">Install Rocko's Gym</div>
                                <div class="text-sm opacity-90">Add to your home screen</div>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="dismissInstallPrompt()" class="px-3 py-2 bg-white/20 rounded-lg text-sm hover:bg-white/30 transition">
                                Later
                            </button>
                            <button onclick="installApp()" class="px-4 py-2 bg-white text-blue-600 rounded-lg text-sm font-semibold hover:bg-gray-100 transition">
                                Install
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const promptDiv = document.createElement('div');
            promptDiv.innerHTML = promptHTML;
            promptDiv.id = 'install-prompt';
            document.body.appendChild(promptDiv);
        }

        window.installApp = async function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
            }
            dismissInstallPrompt();
        };

        window.dismissInstallPrompt = function() {
            const prompt = document.getElementById('install-prompt');
            if (prompt) {
                prompt.remove();
            }
            localStorage.setItem('installPromptShown', 'true');
        };

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }

        // iOS Install Instructions
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        function isInStandaloneMode() {
            return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        }

        // Show iOS install instructions if on iOS and not installed
        if (isIOS() && !isInStandaloneMode() && !localStorage.getItem('iosPromptShown')) {
            setTimeout(() => {
                if (confirm('ðŸ’ª Install Rocko\'s Gym App!\n\nTap the Share button (â¬†ï¸) and then "Add to Home Screen" to install.')) {
                    localStorage.setItem('iosPromptShown', 'true');
                }
            }, 3000);
        }
    </script>
</body>
</html>
